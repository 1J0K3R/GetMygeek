@using GetMygeek.Models
@using System.Text.Json
@using static GetMygeek.Components.Pages.Home

<MudGrid Spacing="10" Justify="Justify.Center">
    @if (phototequeList != null && phototequeList.Phototeques.Count > 0)
    {
        @foreach (var profil in phototequeList.Phototeques)
        {
            <MudItem>
                <Card Profil="@profil"/>
            </MudItem>
        }
    }
    else
    {
        <MudText>Chargement des données...</MudText>
    }
</MudGrid>


@code{
    [Parameter]
    public ResearchQuery researchQuery { get; set; }

    private ListPhototeque phototequeList;

    protected override async Task OnInitializedAsync()
    {
        // Lire et désérialiser le fichier JSON lors de l'initialisation
        phototequeList = await ReadJsonFileAsync();
    }

    // Méthode pour lire et désérialiser le fichier JSON
    private async Task<ListPhototeque> ReadJsonFileAsync()
    {
        try
        {
            FileStream fileStream = File.OpenRead("C:\\Users\\jgiroud\\source\\repos\\GetMygeek\\GetMygeek\\Data\\Phototeque.json");
            return await JsonSerializer.DeserializeAsync<ListPhototeque>(fileStream);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Erreur lors de la lecture du fichier JSON : {ex.Message}");
            return null;
        }
    }
}