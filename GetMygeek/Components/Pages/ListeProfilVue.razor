@using GetMygeek.Data
@using GetMygeek.Data.ORM
@using GetMygeek.Models
@using System.Text.Json
@inject IDatabaseService DatabaseService

<MudGrid Spacing="10" Justify="Justify.Center">
    @if (tableConsultant != null && tableConsultant.Count() > 0)
    {
        @foreach (var profil in tableConsultant)
        {
            <MudItem>
                <Card Profil="@profil"/>
            </MudItem>
        }
    }
    else
    {
        <MudText>Chargement des données...</MudText>
    }
</MudGrid>


@code{
    /// <summary>
    /// Un parametre pour recuperer les parametres rentres dans la recherche
    /// </summary>
    [Parameter]
    public ResearchQuery? researchQuery { get; set; }

    private IEnumerable<Consultant> tableConsultant;

    /// <summary>
    /// Methode d'initialisation de l'objet
    /// </summary>
    /// <returns></returns>
    protected override async Task OnInitializedAsync()
    {
        // Lire et désérialiser le fichier JSON lors de l'initialisation
        tableConsultant = await GetListeProfilBySqlRequestAsync();
    }

    // Méthode pour lire et désérialiser le fichier JSON
    private async Task<IEnumerable<Consultant>> GetListeProfilBySqlRequestAsync()
    {      
        // A partir des paramètres de ResearchQuery on efféctue l'appelle SQL
        // researchQuery.GenerateSQLRequest();
        try
        {
            return await DatabaseService.GetAllConsultantsAsync();     
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Erreur lors de la lecture du fichier JSON : {ex.Message}");
            return null;
        }
    }
}